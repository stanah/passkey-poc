# Rundler ERC-4337 Bundler Docker Compose Configuration
# Self-hosted bundler for Account Abstraction
#
# SETUP:
# 1. Clone Rundler repository:
#    git clone https://github.com/alchemyplatform/rundler.git
#    cd rundler
#    git submodule update --init --recursive
#
# 2. Build the Docker image:
#    docker buildx build . -t rundler
#
# 3. Return to this project and run:
#    docker compose up -d rundler

services:
  anvil:
    image: ghcr.io/foundry-rs/foundry:latest
    entrypoint: ["anvil"]
    command: ["--host", "0.0.0.0", "--chain-id", "31337", "--fork-url", "${ANVIL_FORK_URL}"]
    ports:
      - "8545:8545"
    restart: unless-stopped

  rundler:
    image: rundler
    command: node
    ports:
      # RPC port
      - "3000:3000"
      # Metrics port
      - "8080:8080"
    depends_on:
      - anvil
    environment:
      - RUST_LOG=info
      - CHAIN_ID=31337
      - NODE_HTTP=http://anvil:8545
      - SIGNER_PRIVATE_KEYS=${BUNDLER_PRIVATE_KEY}
      - DISABLE_ENTRY_POINT_V0_6=true
      # CORS configuration for frontend access
      - RPC_CORSDOMAIN=*
      # Skip debug_traceCall (not supported by Tenderly)
      - UNSAFE=true
    restart: unless-stopped
